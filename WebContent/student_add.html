<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>生徒登録</title>
    <script>
        function updateClassNames() {
            const schoolId = document.getElementById("school_id").value;
            const classSelect = document.getElementById("class_name");
            classSelect.innerHTML = '<option value="">選択してください</option>';

            if (schoolId && !isNaN(schoolId)) {

                fetch('/kokushimusou/GetClasses.action?school_id=' + encodeURIComponent(schoolId))
                    .then(response => {
                        if (!response.ok) throw new Error('HTTP ' + response.status);
                        return response.json();
                    })
                    .then(data => {
                        if (data.error) {
                            alert(data.error);
                            return;
                        }
                        data.classNames.forEach(className => {
                            const option = document.createElement("option");
                            option.value = className;
                            option.text = className;
                            classSelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('クラスの取得に失敗しました。');
                    });
            } else {
                alert('有効な学校コードを入力してください。');
            }
        }

        function validateForm() {
            const id = document.getElementsByName("id")[0].value;
            const schoolId = document.getElementsByName("school_id")[0].value;
            const className = document.getElementsByName("class_name")[0].value;
            const name = document.getElementsByName("name")[0].value;
            const entranceYear = document.getElementsByName("entrance_year")[0].value;

            if (!id || !schoolId || !className || !name || !entranceYear) {
                alert("すべての項目を入力してください。");
                return false;
            }
            if (isNaN(id) || isNaN(schoolId) || isNaN(entranceYear)) {
                alert("学生番号、学校コード、入学年は数値を入力してください。");
                return false;
            }
            return true;
        }
    </script>
</head>
<body>
    <h2>生徒登録</h2>
    <form action="/kokushimusou/Beansystem.action" method="POST" onsubmit="return validateForm()">
        【学生番号】<br>
        <input type="number" name="id" required><br><br>
        【学校コード】<br>
        <input type="number" id="school_id" name="school_id" oninput="updateClassNames()" required><br><br>
        【クラス】<br>
        <select name="class_name" id="class_name" required>
            <option value="">選択してください</option>
        </select><br><br>
        【名前】<br>
        <input type="text" name="name" maxlength="50" required><br><br>
        【入学年】<br>
        <input type="number" name="entrance_year" min="1900" max="9999" required><br><br>
       	<input type="checkbox" name="student_flag">在学中<br><br>
        <input type="submit" value="登録"><br><br>
        <br>

        <div id="error" style="color:red;"></div>
    </form>
    <input type="button" value="ホームに戻る" onclick="location.href='/logout.jsp'">
    <input type="button" value="メニューに戻る" onclick="location.href='/menu.jsp'">
</body>
</html>